expand = c(.1, .1)
) +
scale_fill_manual(values = species_cols) +
labs(
title = "",
y = "Number of effect sizes"
) +
theme_minimal(base_size = 12) +
theme(
panel.grid = element_blank(),
legend.position = "none",
axis.text.y  = element_blank(),
axis.ticks.y = element_blank(),
axis.title.y = element_text(margin = margin(r = -40)),
plot.title.position = "panel",
plot.title = element_text(
hjust = 0.5,
margin = margin(b = 6)
)
)
p_alluvial
save_both(p_alluvial, "alluvial_species_nmda_antagonist_atp", w = 9, h = 6)
pA <- bubble_grid(
dat_es,
"atp_drug",
"nmda_antagonist",
"Evidence map: antipsychotic × NMDA antagonist"
)
print(pA)
save_both(pA, "bubble_atp_nmda_antagonist", w = 9, h = 6)
pD <- bubble_grid(
dat_es,
"species",
"atp_drug",
"Evidence map: species × antipsychotic"
)
print(pD)
save_both(pD, "bubble_species_atp", w = 9, h = 6)
p_orch <- orchard_overall_plot(m_overall$rob, title = "Overall effect")
V_main <- make_V(dat_es, rho = rho_main)
m_overall <- fit_mv(dat_es, V_main)
print(m_overall$rob)
I2_overall <- orchaRd::i2_ml(m_overall$rob)
write.csv(data.frame(I2_total = I2_overall[1]), "tables/I2_overall.csv", row.names = FALSE)
p_orch <- orchard_overall_plot(m_overall$rob, title = "Overall effect")
p_orch
save_both(p_orch, "orchard_overall", w = 9, h = 6)
pi_overall <- predict(
m_overall$rob,
pi = TRUE,
digits = 3
)
pi_tbl <- data.frame(
estimate = pi_overall$pred,
ci_lb    = pi_overall$ci.lb,
ci_ub    = pi_overall$ci.ub,
pi_lb    = pi_overall$pi.lb,
pi_ub    = pi_overall$pi.ub
)
pi_tbl
write.csv(
pi_tbl,
"tables/overall_prediction_interval.csv",
row.names = FALSE
)
I2_vals <- orchaRd::i2_ml(m_overall$rob)
i2_tbl <- data.frame(
Component = names(I2_vals),
`I² (%)` = round(as.numeric(I2_vals), 1)
)
i2_tbl
png("figures/funnel_overall_se.png", width = 2400, height = 2000, res = 300)
funnel(
m_overall$raw,
xlab = "Hedges g",
ylab = "Standard Error",
pch  = 21,
bg   = "grey70",
col  = "grey30"
)
dev.off()
pdf("figures/funnel_overall_se.pdf", width = 8, height = 7, useDingbats = FALSE)
funnel(
m_overall$raw,
xlab = "Hedges g",
ylab = "Standard Error",
pch  = 21,
bg   = "grey70",
col  = "grey30"
)
dev.off()
funnel(
m_overall$raw,
xlab = "Hedges g",
ylab = "Standard Error",
pch  = 21,
bg   = "grey70",
col  = "grey30"
)
dat_es <- dat_es %>%
mutate(
n_total = n_exp + n_ctrl,
inv_sqrt_n = 1 / sqrt(n_total)
)
dat_es <- dat_es %>%
mutate(
n_total = n_exp + n_atp,
inv_sqrt_n = 1 / sqrt(n_total)
)
plot(
x = dat_es$yi,
y = dat_es$inv_sqrt_n,
xlab = "Hedges g",
ylab = expression(1 / sqrt(n)),
pch  = 21,
bg   = "grey70",
col  = "grey30"
)
abline(
v   = coef(m_overall$raw)[1],
lwd = 2,
col = "black"
)
png("figures/funnel_overall_inv_sqrtn.png", width = 2400, height = 2000, res = 300)
plot(
x = dat_es$yi,
y = dat_es$inv_sqrt_n,
xlab = "Hedges g",
ylab = expression(1 / sqrt(n)),
pch  = 21,
bg   = "grey70",
col  = "grey30"
)
abline(v = coef(m_overall$raw)[1], lwd = 2, col = "black")
dev.off()
pdf("figures/funnel_overall_inv_sqrtn.pdf", width = 8, height = 7, useDingbats = FALSE)
plot(
x = dat_es$yi,
y = dat_es$inv_sqrt_n,
xlab = "Hedges g",
ylab = expression(1 / sqrt(n)),
pch  = 21,
bg   = "grey70",
col  = "grey30"
)
abline(v = coef(m_overall$raw)[1], lwd = 2, col = "black")
dev.off()
m_pet <- fit_mv(dat_es, V_main, mods = ~ sqrt(vi))
print(m_pet$rob)
pet_tbl <- coef_table(m_pet$rob, "PET")
write.csv(
pet_tbl,
"tables/pet_coefficients.csv",
row.names = FALSE
)
m_peese <- fit_mv(dat_es, V_main, mods = ~ vi)
print(m_peese$rob)
peese_tbl <- coef_table(m_peese$rob, "PEESE")
write.csv(
peese_tbl,
"tables/peese_coefficients.csv",
row.names = FALSE
)
dat_year <- dat_es %>% filter(!is.na(year_publication))
dat_year <- dat_year %>%
mutate(year_c = as.numeric(year_publication) -
mean(as.numeric(year_publication), na.rm = TRUE))
V_year <- make_V(dat_year, rho = rho_main)
m_year <- fit_mv(dat_year, V_year, mods = ~ year_c)
print(m_year$rob)
write.csv(
coef_table(m_year$rob, "Time-lag (year_c)"),
"tables/timelag_coefficients.csv",
row.names = FALSE
)
pred_df <- data.frame(
year_c = seq(min(dat_year$year_c),
max(dat_year$year_c),
length.out = 60)
)
pred <- predict(m_year$raw, newmods = pred_df$year_c)
p_time <- ggplot(dat_year, aes(x = year_publication, y = yi)) +
geom_point(alpha = 0.25) +
geom_line(
data = data.frame(
year_publication = pred_df$year_c +
mean(as.numeric(dat_year$year_publication), na.rm = TRUE),
pred = pred$pred
),
aes(x = year_publication, y = pred),
linewidth = 1,
color = "black"
) +
labs(
title = "Time-lag bias: effect size versus publication year",
x = "Publication year",
y = "Hedges g"
) +
theme_minimal(base_size = 12)
p_time
save_both(p_time, "timelag_year", w = 9, h = 6)
mods_formula <- ~ 0 + atp_drug
m_atp <- fit_mv(dat_es, V_main, mods = mods_formula)
print(m_atp$rob)
tbl_atp <- coef_table(m_atp$rob, "Moderator: Antipsychotic")
write.csv(
tbl_atp,
"tables/mod_atp_drug_coefficients.csv",
row.names = FALSE
)
p_atp <- orchard_mod_plot(
m_atp$rob,
mod = "atp_drug",
title = "By antipsychotic"
)
print(p_atp)
save_both(p_atp, "orchard_by_atp_drug", w = 9, h = 6)
mods_formula <- ~ 0 + atp_schedule
m_atp_sch <- fit_mv(dat_es, V_main, mods = mods_formula)
print(m_atp_sch$rob)
tbl_atp_sch <- coef_table(m_atp_sch$rob, "Moderator: Antipsychotic schedule")
write.csv(
tbl_atp_sch,
"tables/mod_atp_schedule_coefficients.csv",
row.names = FALSE
)
p_atp_sch <- orchard_mod_plot(
m_atp_sch$rob,
mod = "atp_schedule",
title = "By antipsychotic schedule"
)
print(p_atp_sch)
save_both(p_atp_sch, "orchard_by_atp_schedule", w = 9, h = 6)
mods_formula <- ~ 0 + atp_administration_route
m_atp_rt <- fit_mv(dat_es, V_main, mods = mods_formula)
print(m_atp_rt$rob)
tbl_atp_rt <- coef_table(m_atp_rt$rob, "Moderator: Antipsychotic route")
write.csv(
tbl_atp_rt,
"tables/mod_atp_route_coefficients.csv",
row.names = FALSE
)
p_atp_rt <- orchard_mod_plot(
m_atp_rt$rob,
mod = "atp_administration_route",
title = "By antipsychotic administration route"
)
print(p_atp_rt)
save_both(p_atp_rt, "orchard_by_atp_route", w = 9, h = 6)
mods_formula <- ~ 0 + nmda_antagonist
m_ant_ctx <- fit_mv(dat_es, V_main, mods = mods_formula)
print(m_ant_ctx$rob)
tbl_ant_ctx <- coef_table(
m_ant_ctx$rob,
"Moderator: NMDA antagonist (context)"
)
write.csv(
tbl_ant_ctx,
"tables/mod_nmda_antagonist_context_coefficients.csv",
row.names = FALSE
)
p_ant_ctx <- orchard_mod_plot(
m_ant_ctx$rob,
mod = "nmda_antagonist",
title = "By NMDA antagonist (context)"
)
print(p_ant_ctx)
save_both(
p_ant_ctx,
"orchard_by_nmda_antagonist_context",
w = 9,
h = 6
)
mods_formula <- ~ 0 + nmda_antagonist
m_ant_ctx <- fit_mv(dat_es, V_main, mods = mods_formula)
print(m_ant_ctx$rob)
tbl_ant_ctx <- coef_table(
m_ant_ctx$rob,
"Moderator: NMDA antagonist (context)"
)
write.csv(
tbl_ant_ctx,
"tables/mod_nmda_antagonist_context_coefficients.csv",
row.names = FALSE
)
p_ant_ctx <- orchard_mod_plot(
m_ant_ctx$rob,
mod = "nmda_antagonist",
title = "By NMDA antagonist"
)
print(p_ant_ctx)
save_both(
p_ant_ctx,
"orchard_by_nmda_antagonist_context",
w = 9,
h = 6
)
mods_formula <- ~ 0 + species
m_sp <- fit_mv(dat_es, V_main, mods = mods_formula)
print(m_sp$rob)
tbl_sp <- coef_table(m_sp$rob, "Moderator: Species")
write.csv(
tbl_sp,
"tables/mod_species_coefficients.csv",
row.names = FALSE
)
p_sp <- orchard_mod_plot(
m_sp$rob,
mod = "species",
title = "By species"
)
print(p_sp)
save_both(
p_sp,
"orchard_by_species",
w = 9,
h = 6
)
mods_formula <- ~ 0 + developmental_stage_induction
m_dev <- fit_mv(dat_es, V_main, mods = mods_formula)
print(m_dev$rob)
tbl_dev <- coef_table(
m_dev$rob,
"Moderator: Developmental stage (induction)"
)
write.csv(
tbl_dev,
"tables/mod_developmental_stage_induction_coefficients.csv",
row.names = FALSE
)
p_dev <- orchard_mod_plot(
m_dev$rob,
mod = "developmental_stage_induction",
title = "By developmental stage (induction)"
)
print(p_dev)
save_both(
p_dev,
"orchard_by_developmental_stage_induction",
w = 9,
h = 6
)
mods_formula <- ~ 0 + atp_drug:nmda_antagonist
m_int <- fit_mv(dat_es, V_main, mods = mods_formula)
print(m_int$rob)
tbl_int <- coef_table(
m_int$rob,
"Moderator: Antipsychotic × NMDA antagonist"
)
write.csv(
tbl_int,
"tables/mod_atp_nmda_interaction_coefficients.csv",
row.names = FALSE
)
p_int <- orchard_mod_plot(
m_int$rob,
mod = "atp_drug:nmda_antagonist",
title = "By antipsychotic × NMDA antagonist"
)
dat_int <- dat_es %>%
mutate(
atp_nmda_interaction = interaction(
atp_drug,
nmda_antagonist,
sep = " × ",
drop = TRUE
)
)
mods_formula <- ~ 0 + atp_nmda_interaction
m_int <- fit_mv(dat_int, V_main, mods = mods_formula)
print(m_int$rob)
tbl_int <- coef_table(
m_int$rob,
"Moderator: Antipsychotic × NMDA antagonist"
)
write.csv(
tbl_int,
"tables/mod_atp_nmda_interaction_coefficients.csv",
row.names = FALSE
)
p_int <- orchard_mod_plot(
m_int$rob,
mod = "atp_nmda_interaction",
title = "By antipsychotic × NMDA antagonist"
)
print(p_int)
save_both(
p_int,
"orchard_by_atp_nmda_interaction",
w = 10,
h = 6
)
dat_int <- dat_es %>%
mutate(
atp_nmda_interaction = interaction(
atp_drug,
nmda_antagonist,
sep = " × ",
drop = TRUE
)
)
mods_formula <- ~ 0 + atp_nmda_interaction
m_int <- fit_mv(dat_int, V_main, mods = mods_formula)
print(m_int$rob)
tbl_int <- coef_table(
m_int$rob,
"Moderator: Antipsychotic × NMDA antagonist"
)
write.csv(
tbl_int,
"tables/mod_atp_nmda_interaction_coefficients.csv",
row.names = FALSE
)
p_int <- orchard_mod_plot(
m_int$rob,
mod = "atp_nmda_interaction",
title = "By antipsychotic × NMDA antagonist"
)
print(p_int)
save_both(
p_int,
"orchard_by_atp_nmda_interaction",
w = 12,
h = 10
)
## Meta-regression: cumulative antipsychotic exposure
```{r metareg_atp_cumexp, message=FALSE, warning=FALSE}
dat_cum <- dat_es %>%
filter(species %in% c("Rat", "Mouse")) %>%
mutate(
atp_cumulative_exposure = na_if(atp_cumulative_exposure, "NA"),
atp_cumulative_exposure = na_if(atp_cumulative_exposure, ""),
atp_cumulative_exposure = as.numeric(atp_cumulative_exposure)
) %>%
filter(!is.na(atp_cumulative_exposure))
V_cum <- make_V(dat_cum, rho = rho_main)
m_cum <- fit_mv(dat_cum, V_cum, mods = ~ atp_cumulative_exposure)
print(m_cum$rob)
write.csv(
coef_table(m_cum$rob, "Meta-reg: atp_cumulative_exposure"),
"tables/metareg_atp_cumulative_exposure.csv",
row.names = FALSE
)
# Visual
pred_x <- seq(
min(dat_cum$atp_cumulative_exposure, na.rm = TRUE),
max(dat_cum$atp_cumulative_exposure, na.rm = TRUE),
length.out = 80
)
pred <- predict(m_cum$raw, newmods = pred_x)
p_cum <- ggplot(dat_cum, aes(x = atp_cumulative_exposure, y = yi)) +
geom_point(alpha = 0.25) +
geom_line(
data = data.frame(x = pred_x, y = pred$pred),
aes(x = x, y = y),
linewidth = 1,
color = "black"
) +
labs(
title = "Meta-regression: antipsychotic cumulative exposure vs reversal effect",
x = "Antipsychotic cumulative exposure",
y = "Hedges g"
) +
theme_minimal(base_size = 12)
p_cum
save_both(p_cum, "metareg_atp_cumulative_exposure", w = 9, h = 6)
dat_cum <- dat_cum %>%
filter(atp_cumulative_exposure > 0) %>%
mutate(
log_atp_cumulative_exposure = log10(atp_cumulative_exposure)
)
V_cum_log <- make_V(dat_cum, rho = rho_main)
m_cum_log <- fit_mv(
dat_cum,
V_cum_log,
mods = ~ log_atp_cumulative_exposure
)
print(m_cum_log$rob)
write.csv(
coef_table(m_cum_log$rob, "Meta-reg: log10(atp_cumulative_exposure)"),
"tables/metareg_log_atp_cumulative_exposure.csv",
row.names = FALSE
)
# Visual
pred_x_log <- seq(
min(dat_cum$log_atp_cumulative_exposure, na.rm = TRUE),
max(dat_cum$log_atp_cumulative_exposure, na.rm = TRUE),
length.out = 80
)
pred_log <- predict(
m_cum_log$raw,
newmods = pred_x_log
)
p_cum_log <- ggplot(
dat_cum,
aes(x = log_atp_cumulative_exposure, y = yi)
) +
geom_point(alpha = 0.25) +
geom_line(
data = data.frame(x = pred_x_log, y = pred_log$pred),
aes(x = x, y = y),
linewidth = 1,
color = "black"
) +
labs(
title = "Meta-regression: log antipsychotic exposure vs reversal effect",
x = expression(log[10]~"(antipsychotic cumulative exposure)"),
y = "Hedges g"
) +
theme_minimal(base_size = 12)
p_cum_log
save_both(p_cum_log, "metareg_log_atp_cumulative_exposure", w = 9, h = 6)
