---
title: "Flow diagram of study selection"
author: "Matheus Gallas-Lopes"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
    toc: false
    number_sections: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.align = "center"
)
```

The flow diagram presents the study identification, screening, eligibility assessment,
and inclusion process, with detailed reasons for exclusion at each stage.

```{r prisma_flowchart, echo=FALSE, fig.align="center"}
library(DiagrammeR)
library(DiagrammeRsvg)
library(rsvg)

p <- grViz("
digraph prisma {

  graph [
    layout = dot,
    rankdir = TB,
    nodesep = 0.15,
    ranksep = 0.45,
    labelloc = t,
    label = 'Flow diagram of study selection',
    fontsize = 22,
    fontname = Helvetica
  ]

  node [
    shape = box,
    style = 'rounded,filled',
    fontname = Helvetica,
    fontsize = 13,
    width = 2.8,
    penwidth = 1.2,
    color = '#7A7A7A'
  ]

  edge [
    color = '#4D4D4D',
    arrowsize = 0.9,
    penwidth = 1.1
  ]

  A [label = 'Records identified from databases\\n(n = 2261)\\nEmbase (913) • PubMed (708) • Web of Science (640)',
     fillcolor = '#F2F2F2']
  B [label = 'Duplicate records removed\\n(n = 941)',
     fillcolor = '#F2F2F2']

  C [label = 'Records screened\\n(n = 1320)',
     fillcolor = '#FAFAF5']
  D [label = 'Records excluded\\nDesign (204)\\nPopulation (14)\\nIntervention (183)',
     fillcolor = '#FAFAF5']

  E [label = 'Reports sought for retrieval\\n(n = 919)',
     fillcolor = '#FFFFFF']
  F [label = 'Reports not retrieved\\n(n = 8)',
     fillcolor = '#FFFFFF']

  G [label = 'Reports assessed for eligibility\\n(n = 911)',
     fillcolor = '#F8FBF8']
  H [label = 'Reports excluded (full text)\\nDesign (147)\\nPopulation (11)\\nIntervention (172)\\nComparison (12)\\nOutcome (288)\\nData (17)',
     fillcolor = '#F8FBF8']

  I [label = 'Studies included in the review\\n(n = 264)',
     fillcolor = '#EEF5EE']

  A -> B
  A -> C
  C -> D
  C -> E
  E -> F
  E -> G
  G -> H
  G -> I
}
")

p

png_file <- file.path(getwd(), "prisma_flow_diagram.png")

rsvg_png(
  charToRaw(export_svg(p)),
  file = png_file,
  width = 3000,
  height = 4200 
)
```
